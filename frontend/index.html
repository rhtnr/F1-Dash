<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1-Dash - Race Analysis Dashboard</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/charts.css">
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <h1 class="app-title"><span class="title-f1">F1</span><span class="title-dash">-Dash</span></h1>
            <nav class="nav-links">
                <a href="#lap-times" class="nav-link active" data-section="lap-times">Lap Times</a>
                <a href="#strategy" class="nav-link" data-section="strategy">Strategy</a>
                <a href="#telemetry" class="nav-link" data-section="telemetry">Telemetry</a>
                <a href="#race-pace" class="nav-link" data-section="race-pace">Race Pace</a>
                <a href="#predictions" class="nav-link" data-section="predictions">Predictions</a>
            </nav>
        </div>
    </header>

    <main class="app-main">
        <!-- Session Selector -->
        <section class="controls-section">
            <div class="session-selector">
                <div class="select-group">
                    <label for="year-select">Year</label>
                    <select id="year-select" class="select-input">
                        <option value="">Select Year</option>
                    </select>
                </div>
                <div class="select-group">
                    <label for="event-select">Event</label>
                    <select id="event-select" class="select-input" disabled>
                        <option value="">Select Event</option>
                    </select>
                </div>
                <div class="select-group">
                    <label for="session-select">Session</label>
                    <select id="session-select" class="select-input" disabled>
                        <option value="">Select Session</option>
                    </select>
                </div>
                <button id="load-btn" class="btn btn-primary" disabled>Load Data</button>
            </div>
        </section>

        <!-- Lap Times Section -->
        <section id="lap-times" class="chart-section active">
            <div class="section-header">
                <h2>Lap Time Analysis</h2>
                <div class="chart-controls">
                    <div class="driver-filter">
                        <label>Drivers:</label>
                        <div id="driver-checkboxes" class="checkbox-group"></div>
                    </div>
                    <div class="toggle-group">
                        <label>
                            <input type="checkbox" id="valid-only" checked>
                            Valid laps only
                        </label>
                    </div>
                    <div class="toggle-group">
                        <label>
                            <input type="checkbox" id="hide-outliers" checked>
                            Hide outliers
                        </label>
                    </div>
                    <button id="compare-fastest-btn" class="btn btn-secondary" disabled>Compare Fastest Laps</button>
                </div>
            </div>
            <div class="chart-container">
                <div id="lap-times-chart" class="chart"></div>
            </div>
            <div class="chart-container">
                <h3>Lap Times Table</h3>
                <div id="lap-times-table" class="table-container"></div>
            </div>
        </section>

        <!-- Strategy Section -->
        <section id="strategy" class="chart-section">
            <div class="section-header">
                <h2>Tire Strategy</h2>
            </div>
            <div class="chart-container">
                <div id="strategy-chart" class="chart"></div>
            </div>
            <div class="chart-container">
                <h3>Compound Performance</h3>
                <div id="compound-chart" class="chart"></div>
            </div>
        </section>

        <!-- Telemetry Section -->
        <section id="telemetry" class="chart-section">
            <div class="section-header">
                <h2>Telemetry Comparison</h2>
                <div class="chart-controls">
                    <div class="select-group">
                        <label for="telemetry-driver1">Driver 1</label>
                        <select id="telemetry-driver1" class="select-input">
                            <option value="">Select Driver</option>
                        </select>
                    </div>
                    <div class="select-group">
                        <label for="telemetry-lap1">Lap</label>
                        <select id="telemetry-lap1" class="select-input">
                            <option value="">Fastest</option>
                        </select>
                    </div>
                    <div class="select-group">
                        <label for="telemetry-driver2">Driver 2</label>
                        <select id="telemetry-driver2" class="select-input">
                            <option value="">Select Driver</option>
                        </select>
                    </div>
                    <div class="select-group">
                        <label for="telemetry-lap2">Lap</label>
                        <select id="telemetry-lap2" class="select-input">
                            <option value="">Fastest</option>
                        </select>
                    </div>
                    <button id="compare-telemetry-btn" class="btn btn-secondary">Compare</button>
                </div>
            </div>
            <div class="telemetry-grid">
                <div class="chart-container telemetry-main">
                    <h3>Multi-Channel Telemetry</h3>
                    <div id="multi-telemetry-chart" class="chart chart-tall"></div>
                </div>
                <div class="chart-container telemetry-side">
                    <h3>Track Map</h3>
                    <div id="track-map-chart" class="chart chart-square"></div>
                </div>
            </div>
            <div class="chart-container">
                <h3>Speed Trace</h3>
                <div id="speed-trace-chart" class="chart"></div>
            </div>
        </section>

        <!-- Race Pace Section -->
        <section id="race-pace" class="chart-section">
            <div class="section-header">
                <h2>Race Pace Analysis</h2>
            </div>
            <div class="chart-container">
                <h3>Lap Time Distribution by Driver</h3>
                <div id="race-pace-chart" class="chart"></div>
            </div>
            <div class="chart-container">
                <h3>Position Changes</h3>
                <div id="position-chart" class="chart"></div>
            </div>
        </section>

        <!-- Predictions Section -->
        <section id="predictions" class="chart-section">
            <div class="section-header">
                <h2>Race Predictions (ML)</h2>
                <div class="chart-controls">
                    <div class="model-info" id="model-status">
                        <span class="status-indicator"></span>
                        <span class="status-text">Checking model...</span>
                    </div>
                    <div class="toggle-group">
                        <label>
                            <input type="checkbox" id="show-backtest" checked>
                            Show actual results (backtest)
                        </label>
                    </div>
                    <button id="load-prediction-btn" class="btn btn-secondary" disabled>Load Prediction</button>
                </div>
            </div>
            <div class="prediction-info">
                <p>Predictions are based on practice session data (FP1, FP2, FP3) using an XGBoost model trained on historical races.</p>
                <p>Features include: best lap times, average pace, consistency, long run pace, and session positions.</p>
            </div>
            <div class="chart-container">
                <h3>Predicted Finishing Order</h3>
                <div id="prediction-chart" class="chart chart-tall"></div>
            </div>
            <div class="prediction-table-container">
                <h3>Detailed Predictions</h3>
                <div id="prediction-table" class="table-container"></div>
            </div>
        </section>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
            <p>Loading data...</p>
        </div>
    </main>

    <footer class="app-footer">
        <p>F1-Dash | Data powered by <a href="https://github.com/theOehrly/Fast-F1" target="_blank">FastF1</a></p>
    </footer>

    <!-- Application Scripts -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
